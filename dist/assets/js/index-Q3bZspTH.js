import{c as a,r as e,e as t,E as i,j as l,u as s,G as o,x as d,K as n,B as r,J as v,n as u,D as c}from"./vue-vendor-loiPTQO0.js";import{u as m}from"./vehicle-o-oZuL2F.js";import{a as g,b as y,c as h}from"./vehicle-CobAlhmz.js";import{_ as p}from"./index-CD_ICcaK.js";import{u as f,i as b,a as x,b as w,c as M,d as T,e as k,f as D,L}from"./echarts-B-GUJtjs.js";import{b as S,h as R,N as j}from"./ui-vendor-B9LTyEOQ.js";import"./rquest-BdLykTFq.js";import"./user-nHm_wyER.js";const C={class:"mileage-detail-page"},$={class:"data-card total-stats"},z={class:"total-stat"},N={class:"stat-value"},F={class:"total-stat"},_={class:"stat-value"},I={class:"data-card chart-section"},U={class:"month-selector"},A={class:"current-month"},B={class:"chart-container"},E={key:0,class:"loading-chart"},W={key:1,class:"no-data"},q={class:"data-card day-data"},O={class:"card-header"},G={class:"card-date"},J={class:"day-stats-row"},K={class:"day-stat"},P={class:"day-stat-value"},V={class:"day-stat"},Y={class:"day-stat-value"},Z={class:"day-stat"},H={class:"day-stat-value"},Q={class:"day-stats-row"},X={class:"day-stat"},aa={class:"day-stat-value"},ea={class:"day-stat"},ta={class:"day-stat-value"},ia={class:"day-stat"},la={class:"day-stat-value"},sa=p({__name:"index",setup(p){f([b,x,w,M,T,k]);const sa=r(),oa=v(),da=m(),na=a(()=>da.getCurrentVehicle()),ra=e(null),va=e(null),ua=e(!0),ca=e(!1),ma=e(null),ga=new Date,ya=e(ga.getFullYear()),ha=e(ga.getMonth()),pa=a(()=>`${ya.value}.${String(ha.value+1).padStart(2,"0")}`),fa=e(null),ba=e(-1),xa=async a=>{ha.value+=a,ha.value<0?(ha.value=11,ya.value-=1):ha.value>11&&(ha.value=0,ya.value+=1),wa()},wa=async()=>{var a;if(null==(a=na.value)?void 0:a.vinNo){ua.value=!0;try{const a=await y(na.value.vinNo,pa.value);if(a&&a.data){const e=a.data||[];e.length>0?(ca.value=!0,ma.value?ma.value={...ma.value,rideRocordList:e}:ma.value={rideMileageTotal:"0",bendingTimesToal:"0",rideRocordList:e},ba.value=e.length-1,fa.value=e[ba.value].date,await Ma(fa.value)):(ca.value=!1,S("该月暂无骑行数据"))}else ca.value=!1,S("获取月度数据失败")}catch(e){ca.value=!1;const a=new Date(ya.value,ha.value+1,0).getDate(),t=Array(a).fill().map((a,e)=>{const t=e+1;return{date:`${ya.value}.${String(ha.value+1).padStart(2,"0")}.${String(t).padStart(2,"0")}`,rideMileage:Math.random()>.2?(40*Math.random()+10).toFixed(1):(10*Math.random()).toFixed(1)}});ma.value?ma.value={...ma.value,rideRocordList:t}:ma.value={rideMileageTotal:"0",bendingTimesToal:"0",rideRocordList:t},ca.value=!0,ba.value=t.length-1,fa.value=t[ba.value].date}finally{ua.value=!1,R(),u(()=>{ka()})}}},Ma=async a=>{var e;if((null==(e=na.value)?void 0:e.vinNo)&&a)try{const e=await h(na.value.vinNo,a);if(e&&e.data){const a=e.data;ma.value={...ma.value,rideMileageDay:a.rideMileageDay||"0",ridingTimeDayUnitMinute:a.ridingTimeDayUnitMinute||"0",maxSpeed:a.maxSpeed||"0",accelerationTimesDay:a.accelerationTimesDay||"0",brakesTimesDay:a.brakesTimesDay||"0",bendingTimesDay:a.bendingTimesDay||"0"}}}catch(t){}},Ta=()=>{if(!fa.value)return"";const a=fa.value.split(".");return a.length<3?"":`${a[0]}-${a[1]}-${a[2]}`},ka=()=>{var a;if(va.value&&va.value.dispose(),!ra.value||!(null==(a=ma.value)?void 0:a.rideRocordList))return;va.value=D(ra.value);const e=ma.value.rideRocordList.map(a=>(a=>{if(!a)return"";const e=a.split(".");return e.length<3?a:e[2]})(a.date)),t=ma.value.rideRocordList.map(a=>parseFloat(a.rideMileage||0)),i=Math.max(...t),l=i<60?60:Math.ceil(1.2*i);const s=new L(0,0,0,1,[{offset:0,color:"#4361ee"},{offset:1,color:"#3a0ca3"}]),o=new L(0,0,0,1,[{offset:0,color:"#e6e7ff"},{offset:1,color:"#dadcff"}]),d=ba.value>=0?{data:[{coord:[ba.value,t[ba.value]],value:t[ba.value],itemStyle:{color:s},symbolSize:0,label:{show:!1}}],symbol:"circle",symbolSize:0}:{},n={grid:{left:"10%",right:"6%",bottom:"12%",top:"15%",containLabel:!1},dataZoom:[{type:"inside",start:e.length>10?Math.max(0,100-10/e.length*100):0,end:100,zoomLock:!1,throttle:100,minSpan:Math.min(100,Math.max(20,700/e.length))},{type:"slider",show:!1,height:20,bottom:0,start:e.length>10?Math.max(0,100-10/e.length*100):0,end:100}],xAxis:{type:"category",data:e,axisLine:{show:!0,lineStyle:{color:"#eaeaea"}},axisTick:{show:!1},axisLabel:{color:"#666",fontSize:12,fontWeight:400,margin:10}},yAxis:{type:"value",name:"km",nameTextStyle:{padding:[0,0,0,5],fontSize:12,color:"#999"},max:l,interval:15,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{color:"#f5f5f5",type:"dashed",width:1}},axisLabel:{color:"#999",fontSize:12,formatter:function(a){return 0===a?"0":a}}},tooltip:{trigger:"axis",formatter:function(a){const e=a[0];return`${e.name}日: ${e.value} km`},backgroundColor:"rgba(50, 50, 50, 0.7)",borderWidth:0,textStyle:{color:"#fff"},position:function(a,e,t,i,l){return[a[0]-30,a[1]-60]},extraCssText:"border-radius:4px; padding: 6px 10px;"},series:[{type:"bar",data:t,barWidth:"50%",itemStyle:{color:function(a){return a.dataIndex===ba.value?s:o},borderRadius:[4,4,0,0]},markPoint:d,emphasis:{itemStyle:{color:s}},animation:!0,animationDuration:600,animationEasing:"elasticOut",label:{show:!0,position:"top",fontSize:10,color:"#666",formatter:function(a){const e=parseFloat(a.value);return e>0?e.toFixed(1):""},distance:5}}]};va.value.setOption(n),va.value.on("click",async a=>{"series"===a.componentType&&(ba.value=a.dataIndex,fa.value=ma.value.rideRocordList[a.dataIndex].date,await Ma(fa.value))}),window.addEventListener("resize",()=>{va.value&&va.value.resize()})};return t(async()=>{const{vinNo:a}=oa.query;a?await(async()=>{var a;if(null==(a=na.value)?void 0:a.vinNo){ua.value=!0;try{const a=await g(na.value.vinNo);a&&a.data?(ma.value=a.data,ca.value=ma.value.rideRocordList&&ma.value.rideRocordList.length>0,ca.value&&ma.value.rideRocordList.length>0&&(ba.value=ma.value.rideRocordList.length-1,fa.value=ma.value.rideRocordList[ba.value].date),u(()=>{ka()})):(ca.value=!1,S("数据获取失败"))}catch(e){ca.value=!1,ma.value={rideMileageTotal:"5089",bendingTimesToal:"0",greenContribution:"343.5",fate:"2133",rideMileageDay:"24.0",greenContributionDay:"1.6",ridingTimeDay:"0.9",ridingTimeDayUnitMinute:"58",bendingTimesDay:"0",maxSpeed:"66.6",accelerationTimesDay:"36",brakesTimesDay:"26",powerConsumptionDay:"0",rideRocordList:[{date:"2025.08.01",rideMileage:"47.7"},{date:"2025.08.02",rideMileage:"8.5"},{date:"2025.08.03",rideMileage:"45.8"},{date:"2025.08.04",rideMileage:"47.7"},{date:"2025.08.05",rideMileage:"47.8"},{date:"2025.08.06",rideMileage:"47.8"},{date:"2025.08.07",rideMileage:"47.7"},{date:"2025.08.08",rideMileage:"47.9"},{date:"2025.08.09",rideMileage:"53.6"},{date:"2025.08.10",rideMileage:"48.2"},{date:"2025.08.11",rideMileage:"24.0"}]},ca.value=!0,ba.value=ma.value.rideRocordList.length-1,fa.value=ma.value.rideRocordList[ba.value].date,u(()=>{ka()})}finally{ua.value=!1,R()}}})():sa.replace("/")}),(a,e)=>{var t,r,v,u,m,g,y,h;const p=j;return c(),i("div",C,[l(p,{title:"我的骑行","left-arrow":"",onClickLeft:e[0]||(e[0]=a=>s(sa).back()),fixed:""}),o("div",$,[o("div",z,[o("div",N,[d(n((null==(t=ma.value)?void 0:t.rideMileageTotal)||"0"),1),e[3]||(e[3]=o("span",{class:"unit"},"km",-1))]),e[4]||(e[4]=o("div",{class:"stat-label"},"总里程数",-1))]),e[7]||(e[7]=o("div",{class:"stat-divider"},null,-1)),o("div",F,[o("div",_,[d(n((null==(r=ma.value)?void 0:r.bendingTimesToal)||"0"),1),e[5]||(e[5]=o("span",{class:"unit"},"次",-1))]),e[6]||(e[6]=o("div",{class:"stat-label"},"压弯",-1))])]),o("div",I,[o("div",U,[o("div",{class:"month-arrow",onClick:e[1]||(e[1]=a=>xa(-1))},e[8]||(e[8]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[o("polyline",{points:"15 18 9 12 15 6"})],-1)])),o("div",A,n(pa.value),1),o("div",{class:"month-arrow",onClick:e[2]||(e[2]=a=>xa(1))},e[9]||(e[9]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[o("polyline",{points:"9 18 15 12 9 6"})],-1)]))]),o("div",B,[ua.value?(c(),i("div",E,e[10]||(e[10]=[o("div",{class:"loading-spinner"},null,-1),o("div",null,"加载数据中...",-1)]))):ca.value?(c(),i("div",{key:2,class:"chart",ref_key:"chartRef",ref:ra},null,512)):(c(),i("div",W,"暂无骑行数据"))])]),o("div",q,[o("div",O,[e[11]||(e[11]=o("div",{class:"section-title"},"当日数据",-1)),o("div",G,n(Ta()),1)]),o("div",J,[o("div",K,[o("div",P,[d(n((null==(v=ma.value)?void 0:v.rideMileageDay)||"0"),1),e[12]||(e[12]=o("span",{class:"unit"},"km",-1))]),e[13]||(e[13]=o("div",{class:"day-stat-label"},"总里程数",-1))]),o("div",V,[o("div",Y,[d(n((null==(u=ma.value)?void 0:u.ridingTimeDayUnitMinute)||"0"),1),e[14]||(e[14]=o("span",{class:"unit"},"min",-1))]),e[15]||(e[15]=o("div",{class:"day-stat-label"},"时长",-1))]),o("div",Z,[o("div",H,[d(n((null==(m=ma.value)?void 0:m.maxSpeed)||"0"),1),e[16]||(e[16]=o("span",{class:"unit"},"km/h",-1))]),e[17]||(e[17]=o("div",{class:"day-stat-label"},"最高速度",-1))])]),o("div",Q,[o("div",X,[o("div",aa,[d(n((null==(g=ma.value)?void 0:g.accelerationTimesDay)||"0"),1),e[18]||(e[18]=o("span",{class:"unit"},"次",-1))]),e[19]||(e[19]=o("div",{class:"day-stat-label"},"加速",-1))]),o("div",ea,[o("div",ta,[d(n((null==(y=ma.value)?void 0:y.brakesTimesDay)||"0"),1),e[20]||(e[20]=o("span",{class:"unit"},"次",-1))]),e[21]||(e[21]=o("div",{class:"day-stat-label"},"急刹",-1))]),o("div",ia,[o("div",la,[d(n((null==(h=ma.value)?void 0:h.bendingTimesDay)||"0"),1),e[22]||(e[22]=o("span",{class:"unit"},"次",-1))]),e[23]||(e[23]=o("div",{class:"day-stat-label"},"压弯",-1))])])])])}}},[["__scopeId","data-v-c3e6b581"]]);export{sa as default};
