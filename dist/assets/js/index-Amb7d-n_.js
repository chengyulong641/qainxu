import{c as e,r as l,w as a,o as i,e as t,E as s,G as o,K as n,j as d,u as c,H as v,x as r,I as u,V as h,F as m,W as f,Y as p,D as g,U as w,B as y}from"./vue-vendor-loiPTQO0.js";import{g as k}from"./vehicle-CobAlhmz.js";import{u as x}from"./vehicle-o-oZuL2F.js";import{_ as b,u as C}from"./index-CD_ICcaK.js";import{a as M}from"./rquest-BdLykTFq.js";import{u as S}from"./api-polling-K83He-72.js";import{b as j,h as B,P as N,I as T}from"./ui-vendor-B9LTyEOQ.js";import"./user-nHm_wyER.js";const P={class:"vehicle-info-page"},V={class:"top-info-bar"},L={class:"dropdown-title"},I={class:"title-text"},R={class:"top-right"},D={class:"connection-status"},H={class:"connection-indicator"},$={class:"vehicle-popup-header"},_={class:"popup-scroll-container"},E={class:"vehicle-list"},z=["onClick"],U={class:"vehicle-item-image"},q=["src","alt"],O={class:"vehicle-item-info"},A={class:"vehicle-item-name"},F={class:"vehicle-item-type"},G={key:0,class:"vehicle-item-mileage"},K={class:"vehicle-item-status"},W={class:"battery-info"},Y={class:"vehicle-image-container"},J={class:"vehicle-image-wrapper"},Q=["src","alt"],X={class:"location-text"},Z={class:"vehicle-data-container"},ee={class:"data-content"},le={class:"data-section"},ae={class:"data-value-large"},ie={class:"data-section"},te={class:"data-value-large"},se={class:"battery-bar"},oe={class:"data-box right-data"},ne={class:"function-grid"},de={class:"function-label"},ce={class:"progress-bar"},ve={class:"riding-data"},re={class:"riding-stats"},ue={class:"stat-item"},he=["innerHTML"],me={class:"stat-item"},fe={class:"stat-value"},pe={class:"stat-item"},ge={class:"stat-value"},we={class:"vehicle-details-section"},ye={class:"details-grid"},ke={key:0,class:"detail-item"},xe={class:"detail-value"},be={key:1,class:"detail-item"},Ce={class:"detail-value"},Me={key:2,class:"detail-item"},Se={class:"detail-value"},je={key:3,class:"detail-item"},Be={class:"detail-value"},Ne={key:4,class:"detail-item"},Te={class:"detail-value"},Pe={key:5,class:"detail-item"},Ve={class:"detail-value"},Le={key:6,class:"detail-item"},Ie={class:"detail-value"},Re={key:7,class:"detail-item"},De={class:"detail-value"},He={key:8,class:"detail-item"},$e={class:"detail-value"},_e=b({__name:"index",setup(b){const _e=y(),Ee=x(),ze=C(),Ue=e(()=>Ee.vehicleList),qe=e(()=>Ee.currentVehicleIndex),Oe=e(()=>Ee.getCurrentVehicle()),Ae=l(!1),Fe=e=>{var l;if(!(null==(l=Oe.value)?void 0:l.iotProperties))return null;const a=Oe.value.iotProperties.find(l=>l.identify===e);return(null==a?void 0:a.value)||null},Ge=e=>{var l;if(!(null==(l=Oe.value)?void 0:l.iotProperties))return null;const a=Oe.value.iotProperties.find(l=>l.identify===e);return(null==a?void 0:a.describe)||null},Ke=(e,l)=>{if(!(null==e?void 0:e.iotProperties))return null;const a=e.iotProperties.find(e=>e.identify===l);return(null==a?void 0:a.value)||null},We=l("获取中..."),Ye=async()=>{var e;if(null==(e=Oe.value)?void 0:e.location)try{const e=await(async e=>{if(!e||"object"!=typeof e)throw new Error("参数不合法");const{longitude:l,latitude:a,coordinateSystem:i="2"}=e;if(!l||!a)throw new Error("缺少经纬度参数");try{const e="https://restapi.amap.com/v3/geocode/regeo",i=await M.get(e,{params:{key:"f4a9d2af73baa386f745df84b4eeb777",location:`${l},${a}`,extensions:"all",output:"json"}}),{data:t}=i;if("1"===t.status&&"OK"===t.info)return{status:"success",formattedAddress:t.regeocode.formatted_address,addressComponent:t.regeocode.addressComponent,original:t.regeocode,location:{longitude:l,latitude:a}};throw new Error(`获取地址信息失败: ${t.info||"未知错误"}`)}catch(t){throw t}})({longitude:Oe.value.location.longitude,latitude:Oe.value.location.latitude,coordinateSystem:Oe.value.coordinateSystem});"success"===e.status?We.value=e.formattedAddress:We.value="解析地址失败"}catch(l){We.value="获取地址失败"}else We.value="暂无位置信息"};a(()=>{var e;return null==(e=Oe.value)?void 0:e.location},e=>{e&&Ye()},{immediate:!0});const Je=e=>{if(!e)return"0h 0min";return`${Math.floor(Number(e)/60)}<span class="stat-unit">h</span> ${Number(e)%60}min`},Qe=async()=>{var e,l;try{const e=await k();"10000"===e.code&&e.data&&e.data.length>0?Ee.setVehicleList(e.data):j(e.message||"没有车辆信息")}catch(a){j((null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.message)||a.message||"获取车辆数据失败")}finally{B()}},Xe=l(!1),Ze=l(0),el=l(null),ll=()=>{Xe.value=!0,Ze.value=0,el.value=setInterval(()=>{Ze.value<100&&(Ze.value+=1)},50)},al=()=>{clearInterval(el.value),el.value=null,Xe.value=!1,Ze.value=0},il=()=>{showToast("敬请期待...")},tl=()=>{var e;(null==(e=Oe.value)?void 0:e.motoPlay)?showToast("敬请期待..."):showToast("当前车辆不支持 MotoPlay")},sl=()=>{showToast("敬请期待...")},ol=()=>{showToast("敬请期待...")},nl=()=>{},dl=()=>{var e;_e.push({path:"/mileage-detail",query:{vinNo:null==(e=Oe.value)?void 0:e.vinNo}})},cl=()=>{var e;_e.push({path:"/battery-detail",query:{vinNo:null==(e=Oe.value)?void 0:e.vinNo}})},{start:vl,stop:rl,executeNow:ul,updateInterval:hl,setup:ml}=S(Qe,6e3,!1);return i(()=>{rl()}),t(()=>{var e;null==(e=document.querySelector('meta[name="viewport"]'))||e.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),vl()}),(e,l)=>{var a,i,t,y,k,x,b,C,M,S,j,B,_e,Ye,el,vl,rl,ul,hl,ml,fl,pl;const gl=N;return g(),s("div",P,[o("div",V,[o("div",{class:"dropdown-container",onClick:l[0]||(l[0]=e=>Ae.value=!0)},[o("div",L,[o("span",I,n((null==(a=Oe.value)?void 0:a.vehicleName)||"我的车辆"),1),d(c(T),{name:"arrow-down"})])]),o("div",R,[o("div",{class:"refresh-button",onClick:Qe},[d(c(T),{name:"replay",size:"18"})]),o("div",{class:"notification-icon",onClick:l[1]||(l[1]=e=>c(ze).logout())},[d(c(T),{name:"bell",size:"18"})])])]),o("div",D,[o("div",{class:v(["status-item",(null==(i=Oe.value)?void 0:i.gsmRxLevValue)?"connected":"not-connected"])},[d(c(T),{name:"wifi"}),r(" "+n((null==(t=Oe.value)?void 0:t.gsmRxLevValue)||Ge("GSMRxLev")||"未连接")+" ",1),d(c(T),{name:"arrow"})],2),o("div",H,[o("span",{class:v(["dot","1"===(null==(y=Oe.value)?void 0:y.headLockState)||"1"===Fe("HeadLockState")?"connected":"disconnected"])},null,2),r(" "+n("1"===(null==(k=Oe.value)?void 0:k.headLockState)||"1"===Fe("HeadLockState")?"已关锁":"未关锁"),1)])]),d(gl,{show:Ae.value,"onUpdate:show":l[3]||(l[3]=e=>Ae.value=e),position:"bottom",round:"",style:{maxHeight:"60%"},"safe-area-inset-bottom":!0},{default:u(()=>[o("div",$,[l[4]||(l[4]=o("div",{class:"popup-title"},"选择车辆",-1)),o("div",{class:"close-icon",onClick:l[2]||(l[2]=e=>Ae.value=!1)},"✕")]),o("div",_,[o("div",E,[(g(!0),s(m,null,w(Ue.value,(e,a)=>(g(),s("div",{key:e.vinNo,class:v(["vehicle-item",{active:qe.value===a}]),onClick:e=>(e=>{Ee.setCurrentVehicleIndex(e),Ae.value=!1})(a)},[o("div",U,[o("img",{src:e.vehicleScalePicUrl,alt:e.vehicleName},null,8,q)]),o("div",O,[o("div",A,n(e.vehicleName),1),o("div",F,n(e.vehicleType)+" · "+n(e.vehicleTypeName),1),e.totalRideMile?(g(),s("div",G,"总里程: "+n(e.totalRideMile)+"km",1)):p("",!0)]),o("div",K,[o("div",W,[l[5]||(l[5]=o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[o("rect",{x:"1",y:"6",width:"18",height:"12",rx:"2",ry:"2"}),o("line",{x1:"23",y1:"13",x2:"23",y2:"11"})],-1)),r(" "+n(e.bmssoc||Ke(e,"BMSSOC")||"0")+"% ",1)]),o("div",{class:v(["online-status","online"===e.onlineStatus?"online":"offline"])},n("online"===e.onlineStatus?"在线":"离线"),3)])],10,z))),128))])])]),_:1},8,["show"]),o("div",Y,[o("div",J,[o("img",{src:null==(x=Oe.value)?void 0:x.vehiclePicUrl,alt:null==(b=Oe.value)?void 0:b.vehicleName,class:"vehicle-image"},null,8,Q)])]),o("div",{class:"location-info",onClick:nl},[l[6]||(l[6]=o("div",{class:"location-icon"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"#4285F4","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[o("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),o("circle",{cx:"12",cy:"10",r:"3"})])],-1)),o("div",X,n(We.value),1)]),o("div",Z,[o("div",{class:"data-box left-data",onClick:cl},[o("div",ee,[o("div",le,[l[8]||(l[8]=o("div",{class:"data-title"},"预估里程",-1)),o("div",ae,[r(n((null==(C=Oe.value)?void 0:C.hmiRidableMile)||Fe("HMIRidableMile")||"0"),1),l[7]||(l[7]=o("span",{class:"data-unit"},"km",-1))])]),o("div",ie,[l[10]||(l[10]=o("div",{class:"data-title"},"剩余电量",-1)),o("div",te,[r(n((null==(M=Oe.value)?void 0:M.bmssoc)||Fe("BMSSOC")||"0"),1),l[9]||(l[9]=o("span",{class:"data-unit"},"%",-1))]),o("div",se,[o("div",{class:"battery-level",style:h({width:`${(null==(S=Oe.value)?void 0:S.bmssoc)||Fe("BMSSOC")||0}%`})},null,4)])])])]),o("div",oe,[o("div",ne,[o("div",{class:"function-item",onClick:il,onTouchstart:ll,onTouchend:al,onTouchcancel:al},[l[12]||(l[12]=o("div",{class:"function-icon lock-icon"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[o("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),o("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})])],-1)),o("div",de,[Xe.value?(g(),s(m,{key:0},[l[11]||(l[11]=o("span",{class:"pressing-text"},"按住中...",-1)),o("div",ce,[o("div",{class:"progress",style:h({width:`${Ze.value}%`})},null,4)])],64)):(g(),s(m,{key:1},[r("长按开锁")],64))])],32),o("div",{class:"function-item",onClick:tl},l[13]||(l[13]=[f('<div class="function-icon" data-v-fed8cf66><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-fed8cf66><rect x="4" y="4" width="16" height="16" rx="2" ry="2" data-v-fed8cf66></rect><rect x="9" y="9" width="6" height="6" data-v-fed8cf66></rect><line x1="9" y1="1" x2="9" y2="4" data-v-fed8cf66></line><line x1="15" y1="1" x2="15" y2="4" data-v-fed8cf66></line><line x1="9" y1="20" x2="9" y2="23" data-v-fed8cf66></line><line x1="15" y1="20" x2="15" y2="23" data-v-fed8cf66></line><line x1="20" y1="9" x2="23" y2="9" data-v-fed8cf66></line><line x1="20" y1="14" x2="23" y2="14" data-v-fed8cf66></line><line x1="1" y1="9" x2="4" y2="9" data-v-fed8cf66></line><line x1="1" y1="14" x2="4" y2="14" data-v-fed8cf66></line></svg></div><div class="function-label" data-v-fed8cf66>MotoPlay</div>',2)])),o("div",{class:"function-item",onClick:sl},l[14]||(l[14]=[o("div",{class:"function-icon"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[o("path",{d:"M12 2c-.8 0-1.5.5-1.8 1.2l-.1.3c-.2.6-.8 1-1.5 1-.4 0-.8-.1-1.1-.3l-.3-.2c-.7-.5-1.7-.4-2.3.2l-1 1c-.6.6-.7 1.5-.2 2.3l.2.3c.2.3.3.7.3 1.1 0 .7-.4 1.3-1 1.5l-.3.1C2.5 10.5 2 11.2 2 12c0 .8.5 1.5 1.2 1.8l.3.1c.6.2 1 .8 1 1.5 0 .4-.1.8-.3 1.1l-.2.3c-.5.7-.4 1.7.2 2.3l1 1c.6.6 1.5.7 2.3.2l.3-.2c.3-.2.7-.3 1.1-.3.7 0 1.3.4 1.5 1l.1.3c.3.7 1 1.2 1.8 1.2s1.5-.5 1.8-1.2l.1-.3c.2-.6.8-1 1.5-1 .4 0 .8.1 1.1.3l.3.2c.7.5 1.7.4 2.3-.2l1-1c.6-.6.7-1.5.2-2.3l-.2-.3c-.2-.3-.3-.7-.3-1.1 0-.7.4-1.3 1-1.5l.3-.1c.7-.3 1.2-1 1.2-1.8 0-.8-.5-1.5-1.2-1.8l-.3-.1c-.6-.2-1-.8-1-1.5 0-.4.1-.8.3-1.1l.2-.3c.5-.7.4-1.7-.2-2.3l-1-1c-.6-.6-1.5-.7-2.3-.2l-.3.2c-.3.2-.7.3-1.1.3-.7 0-1.3-.4-1.5-1l-.1-.3C13.5 2.5 12.8 2 12 2zm0 8c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2z"})])],-1),o("div",{class:"function-label"}," 车辆设置 ",-1)])),o("div",{class:"function-item",onClick:ol},l[15]||(l[15]=[f('<div class="function-icon" data-v-fed8cf66><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-fed8cf66><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" data-v-fed8cf66></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07" data-v-fed8cf66></path></svg></div><div class="function-label" data-v-fed8cf66>寻车</div>',2)]))])])]),o("div",ve,[o("div",{class:"riding-header",onClick:dl},l[16]||(l[16]=[r(" 我的骑行 "),o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[o("polyline",{points:"9 18 15 12 9 6"})],-1)])),o("div",re,[o("div",ue,[o("div",{class:"stat-value",innerHTML:Je(null==(j=Oe.value)?void 0:j.ridingTimeMonthUnitMinute)},null,8,he),l[17]||(l[17]=o("div",{class:"stat-label"},"本月总时长",-1))]),o("div",me,[o("div",fe,[r(n((null==(B=Oe.value)?void 0:B.rideMileageMonth)||"0"),1),l[18]||(l[18]=o("span",{class:"stat-unit"},"km",-1))]),l[19]||(l[19]=o("div",{class:"stat-label"},"本月行驶距离",-1))]),o("div",pe,[o("div",ge,[r(n((null==(_e=Oe.value)?void 0:_e.avgVelocityMonth)||"0"),1),l[20]||(l[20]=o("span",{class:"stat-unit"},"km/h",-1))]),l[21]||(l[21]=o("div",{class:"stat-label"},"本月行驶均速",-1))])])]),o("div",we,[l[31]||(l[31]=o("div",{class:"section-title"},"车辆详情",-1)),o("div",ye,[(null==(Ye=Oe.value)?void 0:Ye.totalRideMile)?(g(),s("div",ke,[l[22]||(l[22]=o("div",{class:"detail-label"},"总里程",-1)),o("div",xe,n(Oe.value.totalRideMile)+" km",1)])):p("",!0),(null==(el=Oe.value)?void 0:el.maxMileage)?(g(),s("div",be,[l[23]||(l[23]=o("div",{class:"detail-label"},"最大续航里程",-1)),o("div",Ce,n(Oe.value.maxMileage)+" km",1)])):p("",!0),(null==(vl=Oe.value)?void 0:vl.chargeState)?(g(),s("div",Me,[l[24]||(l[24]=o("div",{class:"detail-label"},"充电状态",-1)),o("div",Se,n("1"===Oe.value.chargeState?"充电中":"未充电"),1)])):p("",!0),(null==(rl=Oe.value)?void 0:rl.pressure)?(g(),s("div",je,[l[25]||(l[25]=o("div",{class:"detail-label"},"胎压",-1)),o("div",Be,n(Oe.value.pressureValue||Oe.value.pressure),1)])):p("",!0),(null==(ul=Oe.value)?void 0:ul.activationDate)?(g(),s("div",Ne,[l[26]||(l[26]=o("div",{class:"detail-label"},"激活日期",-1)),o("div",Te,n(Oe.value.activationDate),1)])):p("",!0),(null==(hl=Oe.value)?void 0:hl.firstBindDate)?(g(),s("div",Pe,[l[27]||(l[27]=o("div",{class:"detail-label"},"绑定日期",-1)),o("div",Ve,n((wl=Oe.value.firstBindDate,wl?wl.includes(".")?wl.split(" ")[0].replace(/\./g,"-"):wl:"")),1)])):p("",!0),(null==(ml=Oe.value)?void 0:ml.rechargeEndDate)?(g(),s("div",Le,[l[28]||(l[28]=o("div",{class:"detail-label"},"保修期至",-1)),o("div",Ie,n(Oe.value.rechargeEndDate),1)])):p("",!0),(null==(fl=Oe.value)?void 0:fl.otaVersion)?(g(),s("div",Re,[l[29]||(l[29]=o("div",{class:"detail-label"},"软件版本",-1)),o("div",De,n(Oe.value.otaVersion),1)])):p("",!0),(null==(pl=Oe.value)?void 0:pl.greenContribution)?(g(),s("div",He,[l[30]||(l[30]=o("div",{class:"detail-label"},"绿色贡献",-1)),o("div",$e,n(Oe.value.greenContribution)+" kg",1)])):p("",!0)])])]);var wl}}},[["__scopeId","data-v-fed8cf66"]]);export{_e as default};
